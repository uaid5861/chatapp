import{e as x,o,c as d,a as n,F as b,f as M,u as I,g as V,n as S,t as f,h as _,i as D,j as C,k as U,v as $,l as L,m as j,b as A,q as F}from"./index-93369542.js";import{_ as B}from"./_plugin-vue_export-helper-c27b6911.js";const H={class:"messagecontainer"},N=V('<div class="top" data-v-2c362cde><div class="userinfo" data-v-2c362cde><div class="left" data-v-2c362cde><span data-v-2c362cde>TF_test</span><div data-v-2c362cde>12</div></div><div class="right" data-v-2c362cde>+</div></div></div><div class="search" data-v-2c362cde><input type="text" placeholder="search" data-v-2c362cde></div>',2),K={class:"contact-list"},W=["onClick"],O=["src"],R={class:"namemassage"},q={class:"name"},z={class:"message"},E=x({__name:"ContactList",props:{contacts:{},activeContactId:{}},emits:["selectContact"],setup(y,{emit:g}){const v=y,{contacts:i,activeContactId:r}=v,c=g;function m(u){c("selectContact",u)}return(u,w)=>(o(),d("div",H,[N,n("div",K,[n("ul",null,[(o(!0),d(b,null,M(I(i),l=>(o(),d("li",{key:l.id,onClick:()=>m(l),class:S({active:l.id===I(r)})},[n("img",{src:l.avatar,alt:""},null,8,O),n("div",R,[n("p",q,f(l.name),1),n("p",z,f(l.latestMessage||"暂无新消息"),1)]),n("span",null,f(l.latestMessageTime||""),1)],10,W))),128))])])]))}});const P=B(E,[["__scopeId","data-v-2c362cde"]]),G={class:"chat-window"},J={key:0,style:{"line-height":"1.8","font-weight":"500"}},Q=["src"],X={class:"putbar"},Y={key:0,class:"image-preview"},Z=["src"],ee=x({__name:"ChatWindow",props:{contact:{},messages:{}},emits:["sendMessage"],setup(y,{emit:g}){const v=y,i=g,r=_(""),c=_(""),m=_(null);function u(){if(r.value.trim()||c.value){const t={id:Date.now(),contactId:v.contact.id,text:r.value.trim()||void 0,imageUrl:c.value||void 0,time:new Date().toISOString(),sender:"me"};i("sendMessage",t),r.value="",c.value="",h()}}function w(t){var e;const a=(e=t.target.files)==null?void 0:e[0];if(a){const p=new FileReader;p.onload=k=>{var T;c.value=(T=k.target)==null?void 0:T.result},p.readAsDataURL(a)}}function l(){c.value=""}D(()=>v.messages,async()=>{await j(),h()});function h(){m.value&&(m.value.scrollTop=m.value.scrollHeight)}D(()=>v.contact,()=>{r.value="",c.value=""});function s(t){const a=new Date,e=new Date(t),p=a.getTime()-e.getTime(),k=24*60*60*1e3;return p<k&&a.getDate()===e.getDate()?e.toTimeString().slice(0,5):p<k*2&&a.getDate()-e.getDate()===1?"昨天 "+e.toTimeString().slice(0,5):e.toISOString().slice(0,10)+" "+e.toTimeString().slice(0,5)}return(t,a)=>(o(),d("div",G,[n("h2",null,"与 "+f(t.contact.name)+" 的聊天",1),n("div",{class:"messages",ref_key:"messagesContainer",ref:m},[(o(!0),d(b,null,M(t.messages,e=>(o(),d("div",{key:e.id,class:S(["message",e.sender==="me"?"sent":"received"])},[e.text?(o(),d("p",J,f(e.text),1)):C("",!0),e.imageUrl?(o(),d("img",{key:1,src:e.imageUrl,alt:"Image",style:{"max-width":"100%","border-radius":"10px"}},null,8,Q)):C("",!0),n("small",null,f(s(e.time)),1)],2))),128))],512),n("div",X,[c.value?(o(),d("div",Y,[n("img",{src:c.value,alt:"Image Preview"},null,8,Z),n("button",{onClick:l,class:"remove-btn"},"x")])):C("",!0),c.value?C("",!0):(o(),d("input",{key:1,type:"file",onChange:w,class:"imgboxbtn"},null,32)),U(n("input",{"onUpdate:modelValue":a[0]||(a[0]=e=>r.value=e),onKeyup:L(u,["enter"]),placeholder:"输入消息并按回车发送",class:"sendmessage"},null,544),[[$,r.value]]),n("button",{onClick:u,class:"sendbtn"},"发送")])]))}});const te=B(ee,[["__scopeId","data-v-9f438823"]]),ae={class:"chat-app"},ce=x({__name:"ChatApp",setup(y){const g=_([{id:1,name:"房产中介",avatar:"https://picture.gptkong.com/20240611/222318cb5a43904f4e90bcadd028a5e6f8.jpg"},{id:2,name:"浴皇大帝",avatar:"https://picture.gptkong.com/20240611/22231da7215eff434caa2f683272d69e4c.jpeg"},{id:3,name:"Charlie",avatar:"https://picture.gptkong.com/20240611/222318cb5a43904f4e90bcadd028a5e6f8.jpg"},{id:4,name:"Tifa爱tf",avatar:"https://picture.gptkong.com/20240611/2223ed47c284844c9d94554e328ede0b56.jpg"}]),v=_([{id:1,contactId:1,text:"Hello Alice!",time:"2024/6/17 10:20",sender:"me"},{id:2,contactId:2,text:"Hi Bob!",time:"2024/6/17 11:30",sender:"other"},{id:3,contactId:3,text:"Hey Charlie!",time:"2024/6/17 12:40",sender:"other"}]),i=_(null);function r(s){i.value=s}function c(s){return v.value.filter(t=>t.contactId===s).sort((t,a)=>new Date(t.time).getTime()-new Date(a.time).getTime())}function m(s){v.value.push(s),h(s.contactId,s.text||"图片消息",s.time)}const u=_("");function w(s,t){const a=new Date().toLocaleString(),e={id:Date.now(),contactId:s,text:t,time:a,sender:"other"};v.value.push(e),h(s,t,a)}const l=()=>{i.value&&(w(i.value.id,u.value),u.value="")};function h(s,t,a){const e=g.value.find(p=>p.id===s);e&&(e.latestMessage=t,e.latestMessageTime=a)}return(s,t)=>(o(),d("div",ae,[A(P,{contacts:g.value,onSelectContact:r,activeContactId:i.value?i.value.id:null},null,8,["contacts","activeContactId"]),i.value?(o(),F(te,{key:0,contact:i.value,messages:c(i.value.id),onSendMessage:m},null,8,["contact","messages"])):C("",!0),U(n("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=a=>u.value=a),onKeyup:L(l,["enter"]),class:"test",placeholder:"在此测试输入对方消息"},null,544),[[$,u.value]])]))}});export{ce as default};
